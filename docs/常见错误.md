# Connection reset by peer
## 原因
- 如果一端的Socket被关闭(或主动，或因为异常退出而引起的关闭), 另一端仍发送数据，发送的第一个数据包引发该异常(Connect reset by peer)
- Socket默认链接60秒，60秒之内没有进行心跳交互，即读写数据，就会自动关闭连接
- 一端退出，但退出时并未关闭该连接，另一端如果在从连接中读数据则抛出该异常(Connection reset)
## 例子
- 服务器的并发连接数超过了其承载量，服务器回将其中一些连接关闭
  - 如果知道实际连接服务器的并发客户端有没有超过服务器的承载量，则可能是中了病毒或者木马，引起网络流量异常
  - 可以使用netstat -an 查看网络连接情况
- 客户关掉了浏览器，而服务器还在给客户端发送数据
- 浏览器按了stop
  - 这两种情况一般不会影响服务器，但是如果对异常信息没有特别处理，有可能在服务器的日志文件中，重复出现该异常，造成服务器日志文件过大，影响服务器的运行
  - 可以对引起异常的部分，使用try ... catch捕获异常，然后不输出或者只输出一句提示信息
- 防火墙的问题
  - 如果网络连接通过防火墙，而防火墙一般都会有超时的机制，在网络连接长时间不传输数据时，会关闭这个TCP的会话，关闭后在读写，就会导致异常
  - 如果关闭防火墙，解决了问题，需要重新配置防火墙，或者自己编写程序实现TCP的长连接
  - 实现TCP的长连接，需要自己定义心跳协议，每隔一段时间，发送一次心跳协议，双方维持连接